#!usr/bin/env zsh

#percol alias
#alias -g percol = 'peco'

# kill function
function pekill () {
  for pid in `ps -ef | peco | awk '{ print $2 }'`
  do
    kill $pid
  done
}
zle -N pekill

#rosm
function rosm () {
 for msg in `rosmsg list | peco`
 do
     echo $msg
     rosmsg show $msg
 done
}
zle -N rosm

#rosc
function rosc () {
  for dir in `rospack list |awk '{ print $1 }'|peco`
  do
    roscd $dir
  done
}
zle -N rosc

#rosbp (rosbag play)
function rosbp () {
  for bag in `find ~/rosbags -type f ! -name '*.orig.bag'|peco`
  do 
     rosbag play $bag
  done
}
zle -N rosbp


#rosnode
function rosn () {
    #  case $1 in
    #   ping)
    #   option="ping"
    #   ;;
    #   info)
    #   option="info"
    #   ;;
    #   machine)
    #   option="machine"
    #   ;;
    #   kill)
    #   option="kill"
    #   ;;
    #   cleanup)
    #   option="cleanup"
    #   ;;
    #   * )
    #   help
    #   return
    #   ;;
    # esac
 for nod in `rosnode list | peco `
 do
  rosnode info $nod
 done
}
zle -N rosn

#rostopic
function rost() {
 for tpc in `rostopic list | peco`
 do
     rostopic info $tpc
 done
}
zle -N rost


# search history
function peco-select-history() {
  local tac
  if which tac > /dev/null; then
    tac="tac"
  else
    tac="tail -r"
  fi
  BUFFER=$(\history -n 1 | eval $tac | peco --query "$LBUFFER")
  CURSOR=$#BUFFER
  zle clear-screen
}
zle -N peco-select-history

function eusgrep() {
    for res in `find ~/ -type f -name "*.l" |xargs grep $1| peco`
}
zle -N eusgrep

function eusdef() {
    for res in `find ~/ -type f -name "*.l" |xargs grep $1 |egrep 'defun|defclass|defmethod|defmacro'| peco`
}
zle -N eusdef

function launchgrep() {
    for launch in `find ~/ros/hydro -type f -name "*.launch" |xargs grep $1| peco`
}
zle -N launchgrep

# emacs open file by using peco
function emp() {
    for file in `ls -a |peco`
    do
      em $file
    done
}
zle -N emp

